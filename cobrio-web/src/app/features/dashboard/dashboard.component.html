<div class="dashboard">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold">Dashboard</h1>
    <button pButton label="Atualizar" icon="pi pi-refresh" class="p-button-outlined" (click)="loadDashboard()" [loading]="loading"></button>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
    <div class="stat-card cursor-pointer hover:shadow-lg transition" (click)="navigateToAssinaturas()">
      <div class="stat-icon bg-blue-100 text-blue-600">
        <i class="pi pi-users"></i>
      </div>
      <div class="stat-content">
        <p class="stat-label">Assinaturas Ativas</p>
        <h3 class="stat-value" *ngIf="!loading">{{ metrics.assinaturasAtivas }}</h3>
        <p-skeleton *ngIf="loading" width="4rem" height="2rem"></p-skeleton>
        <small class="text-gray-500 text-xs">{{ metrics.totalAssinaturas }} total</small>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon bg-green-100 text-green-600">
        <i class="pi pi-dollar"></i>
      </div>
      <div class="stat-content">
        <p class="stat-label">Receita Mensal (MRR)</p>
        <h3 class="stat-value" *ngIf="!loading">{{ formatCurrency(metrics.receitaMensal) }}</h3>
        <p-skeleton *ngIf="loading" width="6rem" height="2rem"></p-skeleton>
        <small class="text-gray-500 text-xs">Receita recorrente</small>
      </div>
    </div>

    <div class="stat-card cursor-pointer hover:shadow-lg transition" (click)="navigateToPlanos()">
      <div class="stat-icon bg-purple-100 text-purple-600">
        <i class="pi pi-tag"></i>
      </div>
      <div class="stat-content">
        <p class="stat-label">Planos Ativos</p>
        <h3 class="stat-value" *ngIf="!loading">{{ metrics.planosAtivos }}</h3>
        <p-skeleton *ngIf="loading" width="3rem" height="2rem"></p-skeleton>
        <small class="text-gray-500 text-xs">{{ metrics.totalPlanos }} total</small>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon bg-yellow-100 text-yellow-600">
        <i class="pi pi-chart-line"></i>
      </div>
      <div class="stat-content">
        <p class="stat-label">Taxa de Conversão</p>
        <h3 class="stat-value" *ngIf="!loading">{{ metrics.taxaConversao | number: '1.1-1' }}%</h3>
        <p-skeleton *ngIf="loading" width="3rem" height="2rem"></p-skeleton>
        <small class="text-gray-500 text-xs">Últimos 30 dias</small>
      </div>
    </div>
  </div>

  <!-- Gráficos -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
    <!-- Gráfico de Status -->
    <div class="card bg-white rounded-lg shadow p-6">
      <h2 class="text-xl font-semibold mb-4">Distribuição por Status</h2>
      <div class="chart-container" style="position: relative; height: 300px;">
        <canvas baseChart
          [data]="statusChartData"
          [options]="statusChartOptions"
          type="pie">
        </canvas>
      </div>
    </div>

    <!-- Gráfico de Planos Populares -->
    <div class="card bg-white rounded-lg shadow p-6">
      <h2 class="text-xl font-semibold mb-4">Planos Mais Populares</h2>
      <div class="chart-container" style="position: relative; height: 300px;">
        <canvas baseChart
          [data]="planosChartData"
          [options]="planosChartOptions"
          type="bar">
        </canvas>
      </div>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
    <!-- Planos Recentes -->
    <div class="card bg-white rounded-lg shadow p-6">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-semibold">Planos Cadastrados</h2>
        <button pButton label="Ver todos" icon="pi pi-arrow-right" class="p-button-text p-button-sm" (click)="navigateToPlanos()"></button>
      </div>

      <div *ngIf="loading" class="space-y-3">
        <p-skeleton height="4rem" *ngFor="let i of [1,2,3]"></p-skeleton>
      </div>

      <div *ngIf="!loading && recentPlanos.length === 0" class="text-center py-8">
        <i class="pi pi-inbox text-4xl text-gray-400 mb-3"></i>
        <p class="text-gray-500">Nenhum plano cadastrado</p>
        <button pButton label="Criar Plano" icon="pi pi-plus" class="mt-4" (click)="navigateToPlanos()"></button>
      </div>

      <div *ngIf="!loading && recentPlanos.length > 0" class="space-y-3">
        <div *ngFor="let plano of recentPlanos" class="flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50 transition cursor-pointer" (click)="navigateToPlanos()">
          <div class="flex-1">
            <div class="flex items-center gap-2 mb-1">
              <p class="font-semibold">{{ plano.nome }}</p>
              <p-tag [value]="plano.ativo ? 'Ativo' : 'Inativo'" [severity]="plano.ativo ? 'success' : 'danger'"></p-tag>
            </div>
            <p class="text-sm text-gray-500">{{ plano.tipoCiclo }} - {{ plano.periodoTrial }} dias de trial</p>
          </div>
          <div class="text-right">
            <p class="font-bold text-lg text-green-600">{{ formatCurrency(plano.valor) }}</p>
            <p class="text-xs text-gray-400">por {{ plano.tipoCiclo.toLowerCase() }}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Assinaturas Recentes -->
    <div class="card bg-white rounded-lg shadow p-6">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-semibold">Assinaturas Recentes</h2>
        <button pButton label="Ver todas" icon="pi pi-arrow-right" class="p-button-text p-button-sm" (click)="navigateToAssinaturas()"></button>
      </div>

      <div *ngIf="loading" class="space-y-3">
        <p-skeleton height="4rem" *ngFor="let i of [1,2,3]"></p-skeleton>
      </div>

      <div *ngIf="!loading && recentAssinaturas.length === 0" class="text-center py-8">
        <i class="pi pi-inbox text-4xl text-gray-400 mb-3"></i>
        <p class="text-gray-500">Nenhuma assinatura cadastrada</p>
        <button pButton label="Criar Assinatura" icon="pi pi-plus" class="mt-4" (click)="navigateToAssinaturas()"></button>
      </div>

      <div *ngIf="!loading && recentAssinaturas.length > 0" class="space-y-3">
        <div *ngFor="let assinatura of recentAssinaturas" class="flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50 transition cursor-pointer" (click)="navigateToAssinaturas()">
          <div class="flex-1">
            <div class="flex items-center gap-2 mb-1">
              <p class="font-semibold">{{ assinatura.assinanteNome }}</p>
              <p-tag
                [value]="assinatura.status === 'EmTrial' ? 'Em Trial' : assinatura.status"
                [severity]="getStatusSeverity(assinatura.status)">
              </p-tag>
            </div>
            <p class="text-sm text-gray-500">{{ assinatura.planoNome }}</p>
            <p class="text-xs text-gray-400" *ngIf="assinatura.emTrial">
              Trial até {{ formatDate(assinatura.trialFim || '') }}
            </p>
          </div>
          <div class="text-right">
            <p class="font-bold text-lg text-green-600">{{ formatCurrency(assinatura.valor) }}</p>
            <p class="text-xs text-gray-400">Início: {{ formatDate(assinatura.dataInicio) }}</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
    <!-- Ações Rápidas -->
    <div class="card bg-white rounded-lg shadow p-6">
      <h2 class="text-xl font-semibold mb-4">Ações Rápidas</h2>
      <div class="grid grid-cols-2 gap-3">
        <button pButton label="Nova Assinatura" icon="pi pi-plus" class="p-button-outlined w-full justify-center" (click)="navigateToAssinaturas()"></button>
        <button pButton label="Novo Plano" icon="pi pi-tag" class="p-button-outlined w-full justify-center" (click)="navigateToPlanos()"></button>
        <button pButton label="Relatórios" icon="pi pi-chart-bar" class="p-button-outlined w-full justify-center" [routerLink]="['/relatorios']"></button>
        <button pButton label="Financeiro" icon="pi pi-dollar" class="p-button-outlined w-full justify-center" [routerLink]="['/financeiro']"></button>
      </div>

      <div class="mt-6 p-4 bg-blue-50 rounded-lg">
        <div class="flex items-start gap-3">
          <i class="pi pi-info-circle text-blue-600 text-xl"></i>
          <div>
            <h3 class="font-semibold text-blue-900 mb-1">Bem-vindo ao Cobrio!</h3>
            <p class="text-sm text-blue-700">
              Sistema completo de gestão de assinaturas e cobranças recorrentes.
              Gerencie seus planos, assinaturas e acompanhe suas métricas em tempo real.
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Status do Sistema -->
  <div class="card bg-white rounded-lg shadow p-6">
    <h2 class="text-xl font-semibold mb-4">Status do Sistema</h2>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <div class="flex items-center gap-3 p-3 bg-green-50 rounded-lg">
        <i class="pi pi-check-circle text-green-600 text-2xl"></i>
        <div>
          <p class="text-sm font-medium text-green-900">API Backend</p>
          <p class="text-xs text-green-700">Operacional</p>
        </div>
      </div>

      <div class="flex items-center gap-3 p-3 bg-green-50 rounded-lg">
        <i class="pi pi-database text-green-600 text-2xl"></i>
        <div>
          <p class="text-sm font-medium text-green-900">Banco de Dados</p>
          <p class="text-xs text-green-700">Conectado</p>
        </div>
      </div>

      <div class="flex items-center gap-3 p-3 bg-green-50 rounded-lg">
        <i class="pi pi-shield text-green-600 text-2xl"></i>
        <div>
          <p class="text-sm font-medium text-green-900">Autenticação</p>
          <p class="text-xs text-green-700">Ativa</p>
        </div>
      </div>
    </div>
  </div>
</div>

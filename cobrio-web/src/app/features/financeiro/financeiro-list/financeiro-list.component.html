<div class="container mx-auto">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold">Financeiro</h1>
    <button pButton label="Exportar Relatório" icon="pi pi-download" class="p-button-outlined"></button>
  </div>

  <!-- Métricas Financeiras -->
  <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
    <div class="stat-card">
      <div class="stat-icon bg-green-100 text-green-600">
        <i class="pi pi-check-circle"></i>
      </div>
      <div class="stat-content">
        <p class="stat-label">Pagamentos Recebidos</p>
        <h3 class="stat-value" *ngIf="!loading">{{ formatCurrency(metrics.recebidos) }}</h3>
        <small class="text-gray-500 text-xs">Recebidos este mês</small>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon bg-yellow-100 text-yellow-600">
        <i class="pi pi-clock"></i>
      </div>
      <div class="stat-content">
        <p class="stat-label">Pagamentos Pendentes</p>
        <h3 class="stat-value" *ngIf="!loading">{{ formatCurrency(metrics.pendentes) }}</h3>
        <small class="text-gray-500 text-xs">A receber</small>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon bg-red-100 text-red-600">
        <i class="pi pi-times-circle"></i>
      </div>
      <div class="stat-content">
        <p class="stat-label">Pagamentos Vencidos</p>
        <h3 class="stat-value" *ngIf="!loading">{{ formatCurrency(metrics.vencidos) }}</h3>
        <small class="text-gray-500 text-xs">Requer atenção</small>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon bg-blue-100 text-blue-600">
        <i class="pi pi-dollar"></i>
      </div>
      <div class="stat-content">
        <p class="stat-label">Receita Total</p>
        <h3 class="stat-value" *ngIf="!loading">{{ formatCurrency(metrics.total) }}</h3>
        <small class="text-gray-500 text-xs">Total processado</small>
      </div>
    </div>
  </div>

  <!-- Gráfico de Receita -->
  <div class="card bg-white rounded-lg shadow p-6 mb-6">
    <div class="mb-4">
      <h2 class="text-xl font-semibold mb-2">Evolução da Receita</h2>
      <p class="text-gray-600 text-sm">Crescimento mensal de receita (últimos 6 meses)</p>
    </div>
    <div class="chart-container" style="position: relative; height: 300px;">
      <canvas baseChart
        [data]="receitaChartData"
        [options]="receitaChartOptions"
        type="line">
      </canvas>
    </div>
  </div>

  <!-- Filtros e Lista de Transações -->
  <div class="card bg-white rounded-lg shadow p-6">
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-xl font-semibold">Transações</h2>
      <div class="flex gap-3">
        <div class="flex items-center gap-2">
          <label class="text-sm font-medium">Status:</label>
          <select
            [(ngModel)]="filtroStatus"
            (change)="onFiltroChange()"
            class="border rounded px-3 py-2 text-sm"
          >
            <option *ngFor="let option of statusOptions" [value]="option.value">
              {{ option.label }}
            </option>
          </select>
        </div>
        <div class="flex items-center gap-2">
          <label class="text-sm font-medium">Período:</label>
          <select
            [(ngModel)]="filtroPeriodo"
            (change)="onFiltroChange()"
            class="border rounded px-3 py-2 text-sm"
          >
            <option *ngFor="let option of periodoOptions" [value]="option.value">
              {{ option.label }}
            </option>
          </select>
        </div>
      </div>
    </div>

    <div *ngIf="loading" class="text-center py-8">
      <i class="pi pi-spin pi-spinner text-4xl text-blue-600"></i>
      <p class="text-gray-600 mt-3">Carregando transações...</p>
    </div>

    <div *ngIf="!loading && transacoesFiltradas.length === 0" class="text-center py-8">
      <i class="pi pi-inbox text-4xl text-gray-400 mb-3"></i>
      <p class="text-gray-500">Nenhuma transação encontrada</p>
    </div>

    <div *ngIf="!loading && transacoesFiltradas.length > 0" class="overflow-x-auto">
      <table class="w-full">
        <thead class="bg-gray-50 border-b">
          <tr>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Assinante
            </th>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Plano
            </th>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Valor
            </th>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Vencimento
            </th>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Pagamento
            </th>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Método
            </th>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Status
            </th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          <tr *ngFor="let transacao of transacoesFiltradas" class="hover:bg-gray-50 transition">
            <td class="px-4 py-4">
              <div class="flex items-center">
                <div class="flex-shrink-0 h-10 w-10 bg-blue-100 rounded-full flex items-center justify-center">
                  <i class="pi pi-user text-blue-600"></i>
                </div>
                <div class="ml-3">
                  <p class="text-sm font-medium text-gray-900">{{ transacao.assinante }}</p>
                </div>
              </div>
            </td>
            <td class="px-4 py-4">
              <span class="text-sm text-gray-900">{{ transacao.plano }}</span>
            </td>
            <td class="px-4 py-4">
              <span class="text-sm font-semibold text-green-600">
                {{ formatCurrency(transacao.valor) }}
              </span>
            </td>
            <td class="px-4 py-4">
              <span class="text-sm text-gray-900">{{ formatDate(transacao.dataVencimento) }}</span>
            </td>
            <td class="px-4 py-4">
              <span *ngIf="transacao.dataPagamento" class="text-sm text-gray-900">
                {{ formatDate(transacao.dataPagamento) }}
              </span>
              <span *ngIf="!transacao.dataPagamento" class="text-sm text-gray-400">-</span>
            </td>
            <td class="px-4 py-4">
              <div class="flex items-center">
                <i class="pi pi-credit-card text-gray-400 mr-2"></i>
                <span class="text-sm text-gray-900">{{ transacao.metodo }}</span>
              </div>
            </td>
            <td class="px-4 py-4">
              <span
                class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full"
                [ngClass]="{
                  'bg-green-100 text-green-800': transacao.status === 'Pago',
                  'bg-yellow-100 text-yellow-800': transacao.status === 'Pendente',
                  'bg-red-100 text-red-800': transacao.status === 'Vencido',
                  'bg-gray-100 text-gray-800': transacao.status === 'Cancelado'
                }"
              >
                <i class="pi {{ getStatusIcon(transacao.status) }} mr-1"></i>
                {{ transacao.status }}
              </span>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Resumo da Listagem -->
    <div *ngIf="!loading && transacoesFiltradas.length > 0" class="mt-4 pt-4 border-t flex justify-between items-center">
      <p class="text-sm text-gray-600">
        Exibindo {{ transacoesFiltradas.length }} transações de {{ transacoes.length }} no total
      </p>
      <div class="flex gap-4">
        <div class="text-right">
          <p class="text-xs text-gray-500">Total Filtrado</p>
          <p class="text-lg font-semibold text-blue-600">
            {{ formatCurrency(getTotalFiltrado()) }}
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Insights Financeiros -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-6">
    <div class="card bg-white rounded-lg shadow p-6">
      <div class="flex items-start gap-3">
        <div class="bg-green-100 p-3 rounded-lg">
          <i class="pi pi-trending-up text-green-600 text-2xl"></i>
        </div>
        <div>
          <h3 class="font-semibold mb-1">Taxa de Sucesso</h3>
          <p class="text-2xl font-bold text-green-600">
            {{ getTaxaSucesso().toFixed(1) }}%
          </p>
          <p class="text-xs text-gray-500 mt-1">Pagamentos processados com sucesso</p>
        </div>
      </div>
    </div>

    <div class="card bg-white rounded-lg shadow p-6">
      <div class="flex items-start gap-3">
        <div class="bg-yellow-100 p-3 rounded-lg">
          <i class="pi pi-calendar text-yellow-600 text-2xl"></i>
        </div>
        <div>
          <h3 class="font-semibold mb-1">Ticket Médio</h3>
          <p class="text-2xl font-bold text-yellow-600">
            {{ formatCurrency(getTicketMedio()) }}
          </p>
          <p class="text-xs text-gray-500 mt-1">Valor médio por transação</p>
        </div>
      </div>
    </div>

    <div class="card bg-white rounded-lg shadow p-6">
      <div class="flex items-start gap-3">
        <div class="bg-blue-100 p-3 rounded-lg">
          <i class="pi pi-wallet text-blue-600 text-2xl"></i>
        </div>
        <div>
          <h3 class="font-semibold mb-1">A Receber (30 dias)</h3>
          <p class="text-2xl font-bold text-blue-600">
            {{ formatCurrency(metrics.pendentes) }}
          </p>
          <p class="text-xs text-gray-500 mt-1">Previsão de entrada</p>
        </div>
      </div>
    </div>
  </div>
</div>
